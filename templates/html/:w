<!DOCTYPE HTML>
<html>
	<head>
		<title>Line Chart</title>
		<script src="https://cdn.jsdelivr.net/npm/echarts@5.2.0/dist/echarts.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<link rel="stylesheet" href="../css/line.css"></script>
	</head>

	<body>
		<div id="chart" class="chart"></div>
		<script type="text/javascript">
			
			// Token and device setup
			const READ_ONLY_TOKEN = "BBAU-MRoCiUPLmWFdZj8kvowA6QLepOQN59";
			const DEVICE_NAME = "70b3d57ed00436bb";
			const VARIABLE_NAME = "batmv";

			// Time range and attributes
			const UNIX_START_TIME = 1631748755 * 1000; // Convert to milliseconds
			const UNIX_END_TIME = 1632440109 * 1000; 
			const RETURN_TYPE = "json";
			
			function getValues(callback) {
				const url = "https://industrial.api.ubidots.com/api/v1.6/devices/" +
								DEVICE_NAME + "/" + VARIABLE_NAME + "/values/?start=" +
								UNIX_START_TIME + "&end=" + UNIX_END_TIME +
								"&format=" + RETURN_TYPE;

				const headers = {
					"X-Auth-Token": READ_ONLY_TOKEN, 
					"Content-Type": "applications/json"
				};

				$.ajax({
					url: url, 
					method: "GET",
					headers: headers,
					success: function (res) {
						callback(res.results)
					}
				});

			}

			getValues(function (values) {
				var xValues = new Array();
				var yValues = new Array();
				const data = values.map(function (value, index) {
					xValues.push(parseFloat(value.timestamp));
					yValues.push(parseFloat(value.value));
				})

				var chartDom = document.getElementById('chart');
				var myChart = echarts.init(chartDom);
				var option;

				option = {
					xAxis: {
						type: 'value',
						data: xValues
					},
					yAxis: {
						type: 'value'
					},
					series: [{
						data: yValues,
						type: 'line'
					}]};

				option && myChart.setOption(option);
			});


		</script>
	</body>
</html>
